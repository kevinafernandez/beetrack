<script>
  var map;
  function initMap() {

    var initialLatLng = { //initial coordinates by default (Santiago, Chile)
      lat: -33.447984,
      lng: -70.669608
    };

    var map = new google.maps.Map(document.getElementById('map'), { //init map
      zoom: 11,
      center: initialLatLng
    });

    var markerIcon = "<%= image_path 'vehicle_marker.png' %>";

    var waypoints = JSON.parse(document.querySelector("#map").dataset.waypoints); //get all the most recent waypoints

    waypoints.forEach(function (waypoint) { //iterates over each waypoint per vehicle to display markers on map
      var latLng = new google.maps.LatLng(waypoint.latitude, waypoint.longitude);
      new google.maps.Marker({
        position: latLng,
        map: map,
        icon: markerIcon,
        title: ''
      });
    });

  }
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAvSZsufXR9KYlPdlhivpuhfTtjnh-E3FM&callback=initMap" async
  defer></script>